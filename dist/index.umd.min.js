/*!
 * @bedunkevich/atol v0.0.7
 * (c) Stanislav Bedunkevich
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios"),require("ajv")):"function"==typeof define&&define.amd?define(["exports","axios","ajv"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).atol={},e.axios,e.Ajv)}(this,(function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(t),i=n(r),a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function u(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,u)}s((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var c={$schema:"http://json-schema.org/draft-07/schema#",$ref:"#/definitions/Session",definitions:{Session:{type:"object",properties:{taxationType:{$ref:"#/definitions/TaxationType"},operator:{type:"object",properties:{name:{type:"string"},vatin:{type:"string"}},required:["name","vatin"],additionalProperties:!1}},required:["taxationType","operator"],additionalProperties:!1},TaxationType:{type:"string",enum:["osn","usnIncome","usnIncomeOutcome","envd","esn","patent"]}}},l=new Uint8Array(256),f=l.length;function p(){return f>l.length-16&&(crypto.getRandomValues(l),f=0),l.slice(f,f+=16)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var v,h,y=[],b=0;b<256;++b)y.push((b+256).toString(16).substr(1));function w(e,t){void 0===t&&(t=0);var r=(y[e[t+0]]+y[e[t+1]]+y[e[t+2]]+y[e[t+3]]+"-"+y[e[t+4]]+y[e[t+5]]+"-"+y[e[t+6]]+y[e[t+7]]+"-"+y[e[t+8]]+y[e[t+9]]+"-"+y[e[t+10]]+y[e[t+11]]+y[e[t+12]]+y[e[t+13]]+y[e[t+14]]+y[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&d.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r}var g=0,m=0;function x(e,t,r){var n=t&&r||0,o=t||new Array(16),i=(e=e||{}).node||v,a=void 0!==e.clockseq?e.clockseq:h;if(null==i||null==a){var u=e.random||(e.rng||p)();null==i&&(i=v=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==a&&(a=h=16383&(u[6]<<8|u[7]))}var s=void 0!==e.msecs?e.msecs:Date.now(),c=void 0!==e.nsecs?e.nsecs:m+1,l=s-g+(c-m)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||s>g)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=s,m=c,h=a;var f=(1e4*(268435455&(s+=122192928e5))+c)%4294967296;o[n++]=f>>>24&255,o[n++]=f>>>16&255,o[n++]=f>>>8&255,o[n++]=255&f;var d=s/4294967296*1e4&268435455;o[n++]=d>>>8&255,o[n++]=255&d,o[n++]=d>>>24&15|16,o[n++]=d>>>16&255,o[n++]=a>>>8|128,o[n++]=255&a;for(var y=0;y<6;++y)o[n+y]=i[y];return t||w(o)}var T,S;!function(e){e.ready="ready",e.error="error",e.wait="wait",e.inProgress="inProgress",e.interrupted="interrupted",e.blocked="blocked",e.canceled="canceled"}(T||(T={})),function(e){e.openShift="openShift",e.closeShift="closeShift",e.cashIn="cashIn",e.cashOut="cashOut",e.sell="sell",e.sellReturn="sellReturn",e.buy="buy",e.buyReturn="buyReturn"}(S||(S={}));var k=new i.default({allErrors:!0,removeAdditional:!0,useDefaults:!0});e.init=function(e){return function(e,t){void 0===t&&(t="http://127.0.0.1:16732");var r=o.default.create({baseURL:t,timeout:1e3}),n=k.compile(c);if(!n(e))throw console.log("%c[ATOL] [validation]","color:red",k.errorsText(n.errors)),new Error(k.errorsText(n.errors));var i=e.operator,l=e.taxationType,f=function(e,t){return r.post("/api/v2/request",{uuid:e,request:t})},p=function(e){return r.get("/api/v2/request/"+e)},d=function(e,t){return void 0===t&&(t=0),u(void 0,void 0,void 0,(function(){var r,n,o,i;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),[4,p(e)];case 1:if(r=a.sent().data.results,n=null===(i=null==r?void 0:r[0])||void 0===i?void 0:i.status,console.log("%c[ATOL] [checkStatus]","color:green",r),t>=3)throw new Error("MAX_CALLS LIMIT!");return n===T.ready?[3,3]:[4,(u=1e3,new Promise((function(e){return setTimeout(e,u)})))];case 2:return a.sent(),[2,d(e,t+1)];case 3:return[2,n];case 4:return o=a.sent(),console.log("%c[ATOL] [checkStatus]","color:red",o),[2,T.error];case 5:return[2]}var u}))}))};return{openShift:function(){var e=x();return f(e,[{type:S[S.openShift],operator:i}])},closeShift:function(){var e=x();return f(e,[{type:S[S.closeShift],operator:i}])},cashIn:function(e){var t=x();return f(t,[{type:S[S.cashIn],operator:i},e])},cashOut:function(e){var t=x();return f(t,[{type:S[S.cashOut],operator:i},e])},sell:function(e){var t=x();return f(t,[a({type:S[S.sell],taxationType:l,operator:i},e)])},checkStatus:d}}(e.session,e.baseUrl)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
